# ğŸ¤– AI è‡ªæˆ‘è¿›åŒ–æ—¥å¿— (.ai-errors-log.md)

> æ­¤æ–‡ä»¶æ˜¯ AI çš„å¤–éƒ¨é•¿æœŸè®°å¿†ã€‚
> **æŒ‡ä»¤**ï¼šæ¯æ¬¡å¼€å§‹æ–°ä»»åŠ¡å‰ï¼ŒAI å¿…é¡»è¯»å–æ­¤æ–‡ä»¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ç›¸å…³çš„å†å²é”™è¯¯æ¨¡å¼ï¼Œé¿å…é‡è¹ˆè¦†è¾™ã€‚

## ğŸ§  é”™è¯¯æ¨¡å¼åº“ (Pattern Library)
æ­¤å¤„è®°å½•é«˜é¢‘é”™è¯¯æ¨¡å¼ï¼ŒAI ç¼–ç å‰éœ€å¼ºåˆ¶æ£€ç´¢ã€‚

### é€šç”¨æ¨¡å¼

- **PATTERN-001**: è·¯å¾„æ‹¼æ¥é”™è¯¯ï¼ˆè·¨å¹³å°å…¼å®¹æ€§ï¼‰
  - **ç‰¹å¾**: ä½¿ç”¨ `+ '\\'` æˆ– `+ '/'` æ‹¼æ¥è·¯å¾„
  - **ä¿®æ­£**: å¿…é¡»ä½¿ç”¨ `os.path.join(base, sub, file)`
  - **è§„åˆ™**: `.cursorrules/è·¯å¾„å¤„ç†`
  - **ç¤ºä¾‹**:
    ```python
    # âŒ é”™è¯¯
    path = base_dir + '\\' + filename
    # âœ… æ­£ç¡®
    path = os.path.join(base_dir, filename)
    ```

- **PATTERN-002**: ç±»å‹æç¤ºè¿‡åº¦å¤æ‚
  - **ç‰¹å¾**: ä½¿ç”¨ `Optional[str] = None` ç­‰å¤æ‚ç±»å‹æç¤º
  - **ä¿®æ­£**: éµå¾ª liuns é£æ ¼ï¼Œç®€åŒ–ä¸º `str = None`
  - **è§„åˆ™**: `.cursorrules/ä»£ç é£æ ¼ - ç®€æ´ã€ä¼˜åŒ–ã€æ˜“è¯»`
  - **ç¤ºä¾‹**:
    ```python
    # âŒ è¿‡åº¦å¤æ‚
    from typing import Optional
    def func(file: Optional[str] = None) -> str:
    # âœ… ç®€æ´
    def func(file: str = None) -> str:
    ```


---

## ğŸ“œ è¯¦ç»†é”™è¯¯æµæ°´ (Event Log)

### [2026-01-07] ç®€åŒ–ç±»å‹æç¤ºï¼Œä»£ç æ›´ç®€æ´
- **Context**: `cedar/utils/s_print.py` ç¬¬ 50 è¡Œå‡½æ•°å‚æ•°ç±»å‹æç¤º
- **Pattern**: PATTERN-002
- **Error**: ä½¿ç”¨ `Optional[str] = None` è¿‡åº¦å¤æ‚
- **Root Cause**: ä¸ç¬¦åˆ liuns é£æ ¼ï¼ˆç®€æ´ã€ä¼˜åŒ–ã€æ˜“è¯»ï¼‰
- **Fix**: ç®€åŒ–ä¸º `str = None`ï¼Œç§»é™¤ `Optional` å¯¼å…¥
- **Impact**: ä»£ç æ›´ç®€æ´æ˜“è¯»ï¼Œç¬¦åˆé¡¹ç›®ä»£ç è§„èŒƒ
- **Code**:
  ```python
  # ä¿®æ”¹å‰
  from typing import Any, Optional
  def print(*args: Any, sep: str = ' ', end: str = '\n', file: Optional[str] = None) -> str:
  
  # ä¿®æ”¹å
  from typing import Any
  def print(*args: Any, sep: str = ' ', end: str = '\n', file: str = None) -> str:
  ```
- **çŸ¥è¯†ç‚¹**: Python ç±»å‹æç¤ºç®€åŒ–ï¼Œéµå¾ªé¡¹ç›®ä»£ç é£æ ¼è§„èŒƒ

### [2026-01-08] macOS é€šçŸ¥ä¸å¯é ï¼Œæ”¹ç”¨å¼¹çª—å¯¹è¯æ¡†
- **Context**: `src/status_bar.py` ç¬¬ 370 è¡Œ `showAbout_` æ–¹æ³•
- **Pattern**: PATTERN-003 (æ–°å¢)
- **Error**: ä½¿ç”¨ `NSUserNotificationCenter` å‘é€é€šçŸ¥ï¼Œç”¨æˆ·ç‚¹å‡»åæ— ååº”
- **Root Cause**: macOS é€šçŸ¥ä¸­å¿ƒå¯èƒ½è¢«ç¦ç”¨ã€é™é»˜æˆ–éœ€è¦æƒé™
- **Fix**: æ”¹ç”¨ `NSAlert` å¼¹çª—å¯¹è¯æ¡†ï¼Œæ›´å¯é ä¸”ä¿¡æ¯æ›´ä¸°å¯Œ
- **Impact**: ç”¨æˆ·ä½“éªŒæå‡ï¼Œç¡®ä¿ä¿¡æ¯å±•ç¤º
- **Code**:
  ```python
  # ä¿®æ”¹å‰ (ä¸å¯é )
  def showAbout_(self, sender):
      self.send_notification("CommondX", "Mac æ–‡ä»¶å‰ªåˆ‡ç§»åŠ¨å·¥å…·")
  
  # ä¿®æ”¹å (å¯é )
  def showAbout_(self, sender):
      from AppKit import NSAlert, NSApp
      alert = NSAlert.alloc().init()
      alert.setMessageText_("CommondX")
      alert.setInformativeText_("è¯¦ç»†ä¿¡æ¯...")
      alert.addButtonWithTitle_("ç¡®å®š")
      NSApp.activateIgnoringOtherApps_(True)
      alert.runModal()
  ```
- **çŸ¥è¯†ç‚¹**: macOS å¼€å‘ä¸­ï¼Œé‡è¦ä¿¡æ¯å±•ç¤ºä¼˜å…ˆä½¿ç”¨ `NSAlert`ï¼Œé€šçŸ¥ä»…ç”¨äºåå°æé†’

### é€šç”¨æ¨¡å¼ (æ–°å¢)

- **PATTERN-003**: macOS é€šçŸ¥ä¸å¯é 
  - **ç‰¹å¾**: ä½¿ç”¨ `NSUserNotificationCenter` å±•ç¤ºé‡è¦ä¿¡æ¯
  - **ä¿®æ­£**: é‡è¦ä¿¡æ¯ç”¨ `NSAlert` å¼¹çª—ï¼Œé€šçŸ¥ä»…ç”¨äºåå°æé†’
  - **è§„åˆ™**: ç”¨æˆ·äº¤äº’å¯é æ€§ä¼˜å…ˆ

- **PATTERN-004**: PyInstaller æ‰“åŒ…åè·¯å¾„é—®é¢˜
  - **ç‰¹å¾**: ä½¿ç”¨ `__file__` å®šä½é…ç½®æ–‡ä»¶
  - **ä¿®æ­£**: æ‰“åŒ…å bundle å†…æ–‡ä»¶åªè¯»ï¼Œç”¨æˆ·æ•°æ®éœ€å­˜åˆ° `~/Library/Application Support/`
  - **è§„åˆ™**: é™æ€é…ç½®å†™ä»£ç é‡Œï¼ŒåŠ¨æ€æ•°æ®å­˜ç”¨æˆ·ç›®å½•

- **PATTERN-005**: Finder ç›®æ ‡æ–‡ä»¶å¤¹æ£€æµ‹ä¸å‡†
  - **ç‰¹å¾**: ä½¿ç”¨ `target of front window` è·å–ç›®æ ‡è·¯å¾„
  - **ä¿®æ­£**: ä½¿ç”¨ `insertion location` è·å–å‡†ç¡®çš„æ’å…¥ä½ç½®
  - **è§„åˆ™**: AppleScript ä¼˜å…ˆä½¿ç”¨åŸç”Ÿå±æ€§

- **PATTERN-006**: macOS è¾…åŠ©åŠŸèƒ½æƒé™åŸºäºè·¯å¾„
  - **ç‰¹å¾**: æ¯æ¬¡æ‰“åŒ…åéœ€é‡æ–°æˆæƒ
  - **ä¿®æ­£**: æ‰“åŒ…è„šæœ¬æ·»åŠ  `tccutil reset Accessibility` æ¸…é™¤æ—§è®°å½•
  - **è§„åˆ™**: å¼€å‘æ—¶è‡ªåŠ¨æ¸…ç†æˆæƒç¼“å­˜

---

### [2026-01-08] è®¸å¯è¯ç®¡ç†ç®€åŒ–
- **Context**: `src/license_manager.py` é…ç½®å­˜å‚¨
- **Pattern**: PATTERN-004
- **Error**: é…ç½®æ–‡ä»¶åœ¨æ‰“åŒ…åæ— æ³•å†™å…¥ï¼ˆbundle åªè¯»ï¼‰
- **Fix**: é™æ€é…ç½®ï¼ˆtrial_daysï¼‰å†™ä»£ç é‡Œï¼Œç”¨æˆ·æ•°æ®å­˜ `~/Library/Application Support/CommondX/user.yaml`
- **Impact**: æ‰“åŒ…åæ¿€æ´»åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### [2026-01-08] æƒé™ç®¡ç†æ¨¡å—åŒ–
- **Context**: è¾…åŠ©åŠŸèƒ½æƒé™åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶
- **Fix**: åˆ›å»º `src/permission.py` ç»Ÿä¸€ç®¡ç†
  - `check_accessibility()` - æ£€æŸ¥æƒé™
  - `request_accessibility()` - è¯·æ±‚æƒé™
  - `open_accessibility_settings()` - æ‰“å¼€ç³»ç»Ÿè®¾ç½®
- **Impact**: ä»£ç æ›´æ¸…æ™°ï¼ŒçŠ¶æ€æ èœå•æ”¯æŒæ‰‹åŠ¨æ£€æŸ¥æƒé™

### [2026-01-08] æ¡Œé¢æ–‡ä»¶ç§»åŠ¨ä¿®å¤
- **Context**: `src/cut_manager.py` è·å–ç›®æ ‡æ–‡ä»¶å¤¹
- **Pattern**: PATTERN-005
- **Error**: ä½¿ç”¨ `target of front window` æ— æ³•å‡†ç¡®æ£€æµ‹æ¡Œé¢
- **Fix**: æ”¹ç”¨ `insertion location` è·å– Finder å½“å‰æ’å…¥ä½ç½®
- **Code**:
  ```applescript
  -- ä¿®æ”¹å‰
  return POSIX path of (target of front window as alias)
  
  -- ä¿®æ”¹å
  set insertLoc to insertion location as alias
  return POSIX path of insertLoc
  ```
- **Impact**: æ–‡ä»¶å¯æ­£ç¡®ç§»åŠ¨åˆ°æ¡Œé¢

### [2026-01-08] æ‰“åŒ…è„šæœ¬ä¼˜åŒ–
- **Context**: `tools/build_dmg.sh`
- **Pattern**: PATTERN-006
- **Fix**: æ‰“åŒ…å‰è‡ªåŠ¨æ¸…é™¤è¾…åŠ©åŠŸèƒ½æˆæƒè®°å½•
- **Code**:
  ```bash
  tccutil reset Accessibility com.liuns.commondx 2>/dev/null || true
  ```
- **Impact**: é¿å…æ¯æ¬¡æ‰“åŒ…åæ‰‹åŠ¨æ¸…ç†æˆæƒ

---

### [2026-01-08] å…¨å±€ä»£ç ä¼˜åŒ– - liuns é£æ ¼é‡æ„

æœ¬æ¬¡å¯¹æ•´ä¸ªé¡¹ç›®è¿›è¡Œäº†ç³»ç»Ÿæ€§ä¼˜åŒ–ï¼Œéµå¾ª liuns é£æ ¼ï¼ˆç®€æ´ã€ä¼˜åŒ–ã€æ˜“è¯»ï¼‰ã€‚

#### ä¼˜åŒ–ç»Ÿè®¡
| æ–‡ä»¶ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘ |
|------|--------|--------|------|
| `main.py` | 51 è¡Œ | 26 è¡Œ | 49% |
| `src/app.py` | 149 è¡Œ | 105 è¡Œ | 30% |
| `src/cut_manager.py` | 175 è¡Œ | 110 è¡Œ | 37% |
| `src/event_tap.py` | 125 è¡Œ | 80 è¡Œ | 36% |
| `src/launch_agent.py` | 101 è¡Œ | 66 è¡Œ | 35% |
| `src/license_manager.py` | 114 è¡Œ | 88 è¡Œ | 23% |
| `src/permission.py` | 31 è¡Œ | 24 è¡Œ | 23% |
| `src/status_bar.py` | 495 è¡Œ | 270 è¡Œ | 45% |

#### ä¼˜åŒ–æ¨¡å¼æ€»ç»“

- **PATTERN-007**: æå–å…¬å…±è¾…åŠ©å‡½æ•°
  - **ç‰¹å¾**: é‡å¤çš„ä»£ç å—ï¼ˆå¦‚ subprocess è°ƒç”¨ã€èœå•é¡¹åˆ›å»ºï¼‰
  - **ä¿®æ­£**: æå–ä¸ºç§æœ‰è¾…åŠ©å‡½æ•° `_xxx()`
  - **ç¤ºä¾‹**: `_run_script()`, `_item()`, `_show_alert()`

- **PATTERN-008**: ä½¿ç”¨ pathlib æ›¿ä»£ os.path
  - **ç‰¹å¾**: `os.path.join()`, `os.path.exists()` ç­‰
  - **ä¿®æ­£**: ä½¿ç”¨ `Path` å¯¹è±¡ï¼Œæ›´ç®€æ´ç°ä»£
  - **ç¤ºä¾‹**: `Path.home() / "Library/..."`

- **PATTERN-009**: åˆ é™¤è°ƒè¯•æ—¥å¿—
  - **ç‰¹å¾**: `print(f"[DEBUG] ...")` æˆ– `[TAG] ` å‰ç¼€æ—¥å¿—
  - **ä¿®æ­£**: ç”Ÿäº§ä»£ç åˆ é™¤è°ƒè¯•æ—¥å¿—ï¼Œä¿ç•™å…³é”®æ“ä½œæ—¥å¿—

- **PATTERN-010**: ç®€åŒ–æ¡ä»¶é€»è¾‘
  - **ç‰¹å¾**: æ·±å±‚åµŒå¥—çš„ if-elseã€é‡å¤çš„æ¡ä»¶æ£€æŸ¥
  - **ä¿®æ­£**: æå‰è¿”å›ã€å­—å…¸æ˜ å°„ã€ä¸‰å…ƒè¡¨è¾¾å¼

- **PATTERN-011**: PyObjC NSObject å­ç±»æ–¹æ³•å‘½åå†²çª
  - **ç‰¹å¾**: NSObject å­ç±»ä¸­çš„ `_xxx` æ–¹æ³•è¢«è¯¯è®¤ä¸º ObjC å±æ€§è®¿é—®å™¨
  - **ä¿®æ­£**: è¾…åŠ©æ–¹æ³•æå–åˆ°ç±»å¤–éƒ¨ä½œä¸ºæ™®é€šå‡½æ•°
  - **ç¤ºä¾‹**: `_item` â†’ ç±»å¤– `_add_menu_item()`

#### å…·ä½“ä¼˜åŒ–ç‚¹

1. **åˆ é™¤æœªç”¨å¯¼å…¥**: `sys`, `os`, `threading`, `NSFont`, `Tuple` ç­‰
2. **åˆå¹¶åˆå§‹åŒ–**: `self.a = self.b = self.c = None`
3. **ç»Ÿä¸€ç”¨ pathlib**: `Path()` æ›¿ä»£ `os.path`
4. **æå–å…¬å…±å‡½æ•°**:
   - `cut_manager.py`: `_run_script()`, `_escape()`
   - `status_bar.py`: `_item()`, `_draw_blade()`, `_show_alert()`, `_copy_to_clipboard()`
5. **ç®€åŒ–å‡½æ•°å**: `_notify_state_change` â†’ `_notify`, `verify_activation_code` â†’ `verify`
6. **åˆå¹¶é‡å¤ä»£ç **: `setup_menu()` ä¸­ trial/expired çŠ¶æ€åˆå¹¶
7. **ä½¿ç”¨å­—å…¸æ˜ å°„**: `_start_event_tap()` ä¸­ç”¨å­—å…¸æ›¿ä»£ if-elif-else
8. **å¸¸é‡æå‡**: `FINDER_ID`, `DAY_SECS`, `ACCESSIBILITY_URL` ç­‰

#### é…ç½®å˜æ›´
- **è¯•ç”¨æ—¶é—´**: 3 å¤© â†’ 21 å¤© (`TRIAL_DAYS = 21`)